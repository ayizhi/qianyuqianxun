"use strict";Z(function(){function a(){return Z(document.body).width()}function b(){return Math.ceil(20*window.fontSize)}function c(a){a=a||"";var b={actId:f,actToken:g,sex:h,num:i};a&&(b.recommends=a),userReady(function(){var a=document.createElement("div");a.className="bgCon",Z("#uKaoPuErs").append(a),lazyLoadImg(window.userInfo.headImg,a)}),Z.ajax({url:window.actionUrl.recommendGuest.url,type:window.actionUrl.recommendGuest.type,data:Z.extend(b,getCommonReqData()),success:function(b){b=checkReply(b),b&&a&&userReady(function(){window.location.href="friendCard.html"+getCommonParams()+"&actId="+encodeURIComponent(f)+"&actToken="+encodeURIComponent(g)+"&gsex="+encodeURIComponent(h)+"&gnum="+encodeURIComponent(i)+"&uHead="+encodeURIComponent(window.userInfo.headImg)+"&uName="+encodeURIComponent(window.userInfo.nickname)+"&text="+encodeURIComponent(a)})},error:function(a){noNetwork()},complete:function(){e()}})}function d(){Z(document.body).scrollTop(0),Z("#sendRecommend").show(),setTimeout(function(){Z("#sendRecommend").css("background-color","rgba(0,0,0,0.7)").find(".main").css("transform","translateY(0)")},10)}function e(){Z("#sendRecommend").css("background-color","rgba(0,0,0,0)").find(".main").css("transform","translateY(-100%)"),setTimeout(function(){Z("#sendRecommend").hide()},k)}var f=getValueFromSearch("actId"),g=getValueFromSearch("actToken"),h=getValueFromSearch("sex"),i=getValueFromSearch("num"),j="pics";Z.ajax({url:window.actionUrl.getActGuestInfo.url,type:window.actionUrl.getActGuestInfo.type,data:Z.extend({actId:f,actToken:g,sex:h,num:i},getCommonReqData()),success:function(d){if(console.log("getActGuestInfo reply",d),d=checkReply(d)){swiperReady(function(){function c(a){var b,c,d,e,f,g=Z(a).parent().width(),h=Z(a).parent().height(),i=Z(a).data("w"),j=Z(a).data("h");b=j*g>i*h?g/i:h/j,c=i*b,d=j*b,e=(g-c)/2,f=(h-d)/2,Z(a).css({top:f,left:e,width:c,height:d})}var e,f,g,h=d.photos.length,i=window.dpi*a(),k=window.dpi*b(),l="",m=[];for(e=0;h>e;e++)g=d.photos[e]+"?"+qnImg.base(),m.push(g),f=g+qnImg.and+qnImg.min(i,k)+qnImg.and+qnImg.interlace(),l+='<div class="swiper-slide"><img class="photos" psrc="'+f+'" osrc="'+g+'"></div>';Z("#"+j).find(".swiper-wrapper").html(l).on("click",".photos",function(){var a=$(this).attr("osrc");wxPreviewImg(a,m)});new Swiper(Z("#"+j)[0],{loop:!0,pagination:".swiper-pagination",autoplay:5e3,autoplayDisableOnInteraction:!1});Z(window).on("resize",function(){Z("#"+j).find("img").each(function(){var a=Z(this).attr("psrc");a?(this.onload=function(){Z(this).data("w",this.width).data("h",this.height),c(this)},this.src=a,Z(this).removeAttr("psrc")):c(this)})}).trigger("resize")}),Z("#uname").html(d.nickname);var e="female",f="女",g="她",h=window.imgUrl.femaleHead;1==d.sex&&(e="male",f="男",g="他",h=window.imgUrl.maleHead),Z("#recommendInput").attr("placeholder","写下你对"+g+"的推荐语吧~"),Z(".sexIt").html(g),Z("#uSex").addClass(e),Z("#uAge").html(getAgeFromDate(d.birthday)),Z("#uXingZuo").html(getXingZuoFromDate(d.birthday)),Z("#uPlace").html(d.province+d.city),d.recommended?Z("#kaoPuAct").addClass("fill"):Z("#kaoPuAct").addClass("empty").on("click",function(){Z(this).removeClass("empty").addClass("fill"),c()}),lazyLoadImg(h,Z("#uHead .bgCon")),Z("#uNum").html(d.guestNumber+"号"+f+"嘉宾"),Z("#uSelfIntro").html(d.selfIntro),Z("#uExpectation").html(d.expectation);var i,k,l=d.recommends||[],m=l.length,n="",o=Math.ceil(2.5*window.dpi*window.fontSize);for(i=0;m>i;i++)k=l[i].headImg+"?"+qnImg.base()+qnImg.and+qnImg.min(o,o),n+='<div class="bgCon" psrc="'+k+'"></div>';Z("#uKaoPuErs").html(n).find(".bgCon").each(function(){var a=Z(this).attr("psrc");a&&(lazyLoadImg(a,this),Z(this).removeAttr("psrc"))}),console.log("recommends",d.recommends);var p=['<div class="recommends">','<img class="quote" src="'+window.imgUrl.quote+'">','<div class="text">{text}</div>','<div class="author">','<div class="name">——{nickname}</div>','<div class="bgCon" psrc="{headImg}"></div>',"</div>","</div>"].join(""),q="";for(i=0;m>i;i++)l[i].text&&(k=l[i].headImg+"?"+qnImg.base()+qnImg.and+qnImg.min(o,o),q+=format(p,{text:l[i].text||"",nickname:l[i].nickname||"",headImg:k}));Z("#uRecommendations").html(q).find(".bgCon").each(function(){var a=Z(this).attr("psrc");a&&(lazyLoadImg(a,this),Z(this).removeAttr("psrc"))}),replaceImgSrc(Z("#info")[0]),replaceImgSrc(Z("#sendRecommend")[0])}},error:function(a){noNetwork()}}),userReady(function(){console.log("userReady",window.userInfo),Z("#sendRecommend .author .name").html("——"+window.userInfo.nickname),lazyLoadImg(window.userInfo.headImg,Z("#sendRecommend .author .bgCon"))});var k=300;Z(".footer").on("click",".back",function(){window.location.href="actDetail.html"+getCommonParams()+"&actId="+encodeURIComponent(f)+"&actToken="+encodeURIComponent(g)}).on("click",".recommend",d),Z("#sendRecommend").on("click",".submit",function(a){var b=Z("#recommendInput").val();return b?(Z("#recommendInput").val("").removeClass("warning"),void c(b)):void Z("#recommendInput").addClass("warning").focus()}).on("click",".mask",e),Z("#recommendInput").on("focus",function(){Z("#sendRecommend").removeClass("noScroll")}).on("blur",function(){Z("#sendRecommend").addClass("noScroll")})});
//# sourceMappingURL=guestInfo.js.map