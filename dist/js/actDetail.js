"use strict";Z(function(){function a(a){console.log("showLinkResult",a);var b,c,d,e,f=j("#result").show(),g=['<div class="pair p{fNum}" fNum={fNum}>','<div class="flag">{fNum}</div>','<div class="title">共同完成{taskNum}个约会任务</div>','<div class="main">','<div class="box female">','<div class="bgCon" psrc="{fHead}"></div>','<div class="info">','<div class="num">女{fNum}</div>','<div class="name">{fName}</div>',"</div>","</div>",'<img class="fire" src="'+window.imgUrl.whiteFire+'">','<div class="box male">','<div class="bgCon" psrc="{mHead}"></div>','<div class="info">','<div class="num">男{mNum}</div>','<div class="name">{mName}</div>',"</div>","</div>",'<div class="tips">查看约会进度</div>',"</div>","</div>"].join(""),h='<img id="datingTitle" src="'+window.imgUrl.datingTitle+'">',i=a.pairs||window.actConfig.pairs,m={},n=2*window.fontSize,o="?"+qnImg.base()+qnImg.and+qnImg.min(n*window.dpi,n*window.dpi);for(b=0;i>b;b++){for(c=0;i>c&&(d=a.females[c],d.guestNumber!=b+1);c++);for(c=0;i>c&&(e=a.males[c],e.guestNumber!=d.linkedNumber);c++);m.taskNum=d.taskNum,m.fNum=b+1,m.fHead=d.headImg+o,m.fName=d.nickname,m.mNum=e.guestNumber,m.mHead=e.headImg+o,m.mName=e.nickname,h+=format(g,m)}h+='<img id="resultTitle" src="'+window.imgUrl.resultTitle+'">',f.html(h).find(".bgCon").each(function(){var a=j(this).attr("psrc");lazyLoadImg(a,this)}),f.on("click",".pair",function(){var a=j(this).attr("fNum");window.location.href="dating.html"+getCommonParams()+"&actId="+encodeURIComponent(k)+"&actToken="+l+"&fNum="+encodeURIComponent(a)})}function b(){shareGuide("邀请好友挑战")}function c(a){console.log("showPersonDetail",a),window.location.href="guestInfo.html"+getCommonParams()+"&actId="+encodeURIComponent(k)+"&actToken="+l+"&sex="+encodeURIComponent(a.sex)+"&num="+encodeURIComponent(a.guestNumber)}function d(a,b){if(!q){q=!0,console.log("linkInit",a);var d,e=Math.ceil(2*window.fontSize),f=a.pairs||a.females.length,h="?"+qnImg.base()+qnImg.and+qnImg.min(e*window.dpi,e*window.dpi);for(d=0;f>d;d++)a.females[d].headImg+=h,a.males[d].headImg+=h;console.log("detailFlag",n),g=new LinkMap(Z("#card .middle canvas")[0],{deltaY:-30,pairs:f,defaultFemaleHead:window.imgUrl.femaleHead,defaultMaleHead:window.imgUrl.maleHead,topPadding:Math.ceil(.4*window.fontSize),headSize:e,thickness:Math.ceil(.1*window.fontSize),neckDefaultColor:"#fff",deskHeight:Math.ceil(7*window.fontSize),deskMarginTop:Math.ceil(.4*window.fontSize),dotSize:Math.ceil(.3*window.fontSize),dotGapDesk:Math.ceil(.2*window.fontSize),deskRadius:Math.ceil(.25*window.fontSize),deskColor:"#F0EFF5",dotDefaultColor:"#E2D0C4",linkColor:"#EA4C89",lineWidth:1,topIs:"f",disorder:a.disorder,females:a.females,males:a.males,showGuest:n,textSize:Math.floor(.4*window.fontSize),femaleTextColor:"#fff",femaleTextBg:"#F641BF",maleTextColor:"#fff",maleTextBg:"#0092F4",canLink:function(){return m},onClick:function(a){n&&c(a[0])},onLink:function(a){},onBreak:function(a){},onChoose:function(a){},onCancel:function(a){}}),"function"==typeof b&&b(a),window.lm=g}}function e(){if(!r){var a=g.getLinkResult();if(!a)return void alert("请给每一位嘉宾连线之后再提交喔");console.log("resultMap",a),r=!0,Z.ajax({url:window.actionUrl.submitLink.url,type:window.actionUrl.submitLink.type,data:Z.extend({actId:k,actToken:l,map:a},getCommonReqData()),success:function(b){console.log("submitLink reply",b),b=checkReply(b),b&&(0==b.status?(alert("谢谢，连线提交成功"),userReady(function(){window.location.href="linkerCard.html"+getCommonParams()+"&actId="+encodeURIComponent(k)+"&actToken="+encodeURIComponent(l)+"&map="+encodeURIComponent(JSON.stringify(a))+"&uHead="+encodeURIComponent(window.userInfo.headImg)+"&uName="+encodeURIComponent(window.userInfo.nickname)})):alert("噫，提交失败了，再试试吧"))},error:function(a){noNetwork()},complete:function(){r=!1}})}}function f(c){console.log("renderDetail",c);var f,j,q,r=Z("#card");r.find(".top .title").html(c.title),r.find(".top .info").html(c.creatorName+" · "+getDateFromTs(c.createTime));var s=Math.ceil(4*window.fontSize);"?"+qnImg.base()+qnImg.and+qnImg.min(s*window.dpi,s*window.dpi);lazyLoadImg(c.creatorHead,r.find(".top .head .bgCon"));var t=r.find(".top"),u=t.width(),v=t.height(),w="?"+qnImg.base()+qnImg.and+qnImg.min(u,v)+qnImg.and+qnImg.blur(15,5);lazyLoadImg(c.cover+w,r.find(".top")),r.find(".bottom .buttons").hide(),replaceImgSrc(Z("#card"));var x,y,z;switch(c.status){case window.actConfig.registering:for(z=window.imgUrl.registeringFlag,j=[],q=[],f=0;f<window.actConfig.pairs;f++)j.push({headImg:window.imgUrl.femaleHead}),q.push({headImg:window.imgUrl.maleHead});m=!1,n=!1,x={females:j,males:q},c.creatorId==window.uid?(o.html("选择嘉宾"),h=function(){console.log("selectGuest"),window.location.href="selectGuest.html"+getCommonParams()+"&actId="+encodeURIComponent(k)+"&actToken="+encodeURIComponent(l)}):(0==c.registered?o.html("查看报名资料"):o.html("报名挑战"),h=function(){window.location.href="registerAct.html"+getCommonParams()+"&actId="+encodeURIComponent(k)+"&actToken="+encodeURIComponent(l)}),p.html("邀请好友"),i=b;break;case window.actConfig.linking:z=window.imgUrl.linkingFlag,m=!0,n=!0,x=c,o.html("查看连线数据"),h=function(){window.location.href="actLinkData.html"+getCommonParams()+"&actId="+encodeURIComponent(k)+"&actToken="+encodeURIComponent(l)},p.html("提交连线方案"),i=e;break;case window.actConfig.dating:z=window.imgUrl.datingFlag,m=!1,n=!0,x=c,y=function(a){for(var b=0;b<a.pairs;b++)g.link(a.males[b].guestNumber,a.males[b].linkedNumber)},o.html("查看连线数据"),h=function(){window.location.href="actLinkData.html"+getCommonParams()+"&actId="+encodeURIComponent(k)+"&actToken="+encodeURIComponent(l)},p.html("分享"),i=b,a(c);break;default:return void alert("活动进度状态码异常:"+c.status)}t.find(".sf").attr("src",z),linkMapReady(function(){d(x,y)})}var g,h,i,j=Z,k=getValueFromSearch("actId"),l=getValueFromSearch("actToken"),m=!1,n=!1,o=Z("#footer .left"),p=Z("#footer .right"),q=!1,r=!1;Z.ajax({url:window.actionUrl.getActDetail.url,type:window.actionUrl.getActDetail.type,data:Z.extend({actId:k,actToken:l},getCommonReqData()),success:function(a){a=checkReply(a),a&&f(a)},error:function(a){noNetwork()}}),Z("#footer").on("click",".back",function(){window.location.href="actList.html"+getCommonParams()}).on("click",".left",function(){h&&h()}).on("click",".right",function(){i&&i()})});
//# sourceMappingURL=actDetail.js.map