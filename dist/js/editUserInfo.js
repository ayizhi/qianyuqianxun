Z(function(){function a(a){locationReady(function(){console.log("province",myProvince),console.log("city",myCity);var b,c="";for(b in myProvince)c+='<option value="'+b+'">'+myProvince[b]+"</option>";e("#provinceInput").html(c).mySelect(function(a){return myProvince[a]}).on("change",function(){var a,b=this.value,c=myCity[b],d="";for(a in c)d+='<option value="'+a+'">'+c[a]+"</option>";e("#cityInput").html(d).trigger("change")}).trigger("change"),e("#cityInput").mySelect(function(a){var b=e("#provinceInput").val();return myCity[b][a]}),a&&a()})}function b(){j||(j=!0,Z.ajax({url:window.actionUrl.getUserInfo.url,type:window.actionUrl.getUserInfo.type,data:getCommonReqData(),success:function(b){if(console.log("getRegisterInfo reply",b),b=checkReply(b)){0==b.sex?Z("#sex").html('<img src="../img/common/women.png" alt=""/>'):Z("#sex").html('<img src="../img/common/men.png" alt=""/>');var d=getAgeFromDate(b.birthday),g=getXingZuoFromDate(b.birthday);Z("#age").html(d),Z("#xingZuo").html(g),Z("#nicknameInput").val(b.nickname),Z("#birthdayInput").val(b.birthday),Z("#wxInput").val(b.wx),Z("#sexInput").val(b.sex).trigger("change"),Z("#mobileInput").val(b.mobile),Z("#selfIntroInput").val(b.selfIntro),Z("#expectationInput").val(b.expectation),Z("#submit").html("提交修改"),replaceImgSrc(Z("#actNav"));var j=Math.ceil(2.2*window.fontSize),k="?"+qnImg.base()+qnImg.and+qnImg.min(j*window.dpi,j*window.dpi);lazyLoadImg(b.headImg+k,Z("#creatorHead"));var l=Math.ceil(e(document.body).width()),m=Math.ceil(3.3*window.fontSize);"?"+qnImg.base()+qnImg.and+qnImg.min(l,m)+qnImg.and+qnImg.blur(15,5);a(function(){var a,c,d;for(d in myProvince)if(myProvince[d]==b.province){a=d;break}var e=myCity[a];for(d in e)if(e[d]==b.city){c=d;break}console.log("province",a,b.province),console.log("city",e,c,b.city),a&&c&&(Z("#provinceInput").val(a).trigger("change"),Z("#cityInput").val(c).trigger("change"))}),qiNiuReady(function(){var a=b.headImg,d=Math.ceil(4*window.fontSize),g="?"+qnImg.base()+qnImg.and+qnImg.min(d*window.dpi,d*window.dpi),j=a+g,k={fid:"",isHead:" "+h,text:"头像",osrc:a+i,psrc:j},l=format(f,k);Z(l).insertBefore(Z("#qnPicker"));for(var m=b.photos||[],n=m.length>6?6:m.length,o=0;n>o;o++)k.fid="",k.text="",k.isHead="",k.osrc=m[o]+i,k.psrc=m[o]+g,l=format(f,k),Z(l).insertBefore(Z("#qnPicker"));e("#qnCon .imgBlock").each(function(){var a=e(this).attr("psrc");a&&lazyLoadImg(a,this)}),c()})}},error:function(a){noNetwork()},complete:function(){j=!1}}))}function c(){var a,b,c=g.length;for(b=0;c>b;b++)g[b].refresh(),a=g[b].getOption("browse_button")[0],Z(a).width()<1&&(g[b].destroy(),g.splice(b,1),c--,b--)}function d(a){var b=Z("#"+a).val();return b&&b.length?b:(Z("#"+a).addClass("warning").focus(),!1)}var e=Z,f=['<div class="imgBlock bgCon ing{isHead}" fid="{fid}" psrc="{psrc}" osrc="{osrc}">','<div class="text">{text}</div>','<img class="delete" src="'+window.imgUrl.close+'">','<div class="progress"></div>',"</div>"].join(""),g=[],h="head",i="?"+qnImg.base();Z("#sexInput").mySelect(function(a){switch(parseInt(a)){case 0:return"女";case 1:return"男";default:alert("性别选择异常"+a)}}),b();var j=!1;Z(window).on("resize",c),qiNiuReady(function(){var a=myUp({bb:"qnPicker",con:"qnCon"});g.push(a),a.bind("FileUploaded",function(a,b,c){console.log("FileUploaded",b.id);var d=a.getOption("domain");c=JSON.parse(c.response);var f=Math.ceil(4*window.fontSize),g="?"+qnImg.base()+qnImg.and+qnImg.min(f*window.dpi,f*window.dpi),j=d+c.key,k=j+g;e(".imgBlock").each(function(){var a=e(this);a.attr("fid")==b.id&&(a.removeClass("ing").find(".progress").css("top",100-b.percent+"%"),lazyLoadImg(k,a.attr("osrc",j+i)),a.hasClass(h)&&a.find(".text").html("头像"))})}),a.bind("BeforeUpload",function(a,b){console.log("BeforeUpload",b.id);var c=" "+h;e(".imgBlock."+h).length&&(c="");var d={isHead:c,fid:b.id,text:"上传中",psrc:"",osrc:""},g=format(f,d);Z(g).insertBefore(Z("#qnPicker"))}),a.bind("UploadProgress",function(a,b){console.log("UploadProgress",b.id,b.percent),e(".imgBlock").each(function(){e(this).attr("fid")==b.id&&Z(this).find(".progress").css("top",100-b.percent+"%")})})}),Z("#qnCon").on("click",".delete",function(){if(confirm("确认要删除这张头像吗")){var a,b=Z(this).parent(),d=b.hasClass(h);b.addClass("empty").remove(),d&&(a=Z("#qnCon").find(".imgBlock")[0],e(a).hasClass("empty")||e(a).addClass(h).find(".text").html("头像")),c()}}).on("click",".imgBlock",function(){if(!e(this).hasClass("empty")){var a=e(this).attr("osrc");if(a){var b=[];e("#qnCon .imgBlock").each(function(){if(!e(this).hasClass("empty")){var a=e(this).attr("osrc");a&&b.push(a)}}),wxPreviewImg(a,b)}}});var k=!1;Z("#submit").on("click",function(){if(!k&&myProvince){var a=d("nicknameInput");if(a){var b=d("mobileInput");if(b){var c=d("wxInput");if(c){var e,f=Z("#qnCon").find(".imgBlock"),g=f.length,i=0;for(e=0;g>e;e++)Z(f[e]).hasClass("empty")||i++;if(console.log("imgNum",i),2>i)return void alert("请上传至少两张照片");var j=Z("."+h).data("src"),l=[];f.each(function(){Z(this).hasClass("empty")||Z(this).hasClass(h)||l.push(Z(this).data("src"))});var m=d("selfIntroInput");if(m){var n=d("expectationInput");if(n){var o=Z("#birthdayInput").val(),p=Z("#sexInput").val(),q=Z("#provinceInput").val(),r=myProvince[q],s=Z("#cityInput").val(),t=myCity[q][s];k=!0,Z("#submit").html("加入中...");var u={nickname:a,mobile:b,wx:c,province:r,city:t,selfIntro:m,expectation:n,birthday:o,sex:p,headImg:j,photos:l};console.log("reqData",u),Z.ajax({url:window.actionUrl.editInfo.url,type:window.actionUrl.editInfo.type,data:Z.extend(getCommonReqData(),u),success:function(a){console.log("submit reply",a),a=checkReply(a),a&&(0==a.status?(console.log("修改成功"),window.history.go(-1)):(alert("修改失败，请重试"),pageReload()))},error:function(a){console.log("submit error",a),noNetwork()},complete:function(){console.log("submit complete"),k=!1,Z("#submit").html("修改成功")}})}}}}}}}),Z(".footer").on("click",".back",function(){window.history.go(-1)})});
//# sourceMappingURL=editUserInfo.js.map