"use strict";Z(function(){function a(a){a&&(console.log("toPersonPage",a),window.location.href="userInfo.html"+getCommonParams()+"&targetId="+encodeURIComponent(a))}function b(){l||(l=!0,h.ajax({url:window.actionUrl.getDatingTasks.url,type:window.actionUrl.getDatingTasks.type,data:h.extend({actId:e,actToken:f,fNum:g},getCommonReqData()),success:function(b){function l(){var a=h(this);a.data("ts",1),a.hasClass("hover")||setTimeout(function(){a.data("ts")&&a.data("ts",0).addClass("hover")},Q)}function m(){var a=h(this);a.data("ts",0),a.removeClass("hover")}function n(a){for(var b=a.target;!h(b).hasClass("commentText");){if(h(b).hasClass("name")||h(b).hasClass("target"))return;b=b.parentNode}var c=h(this);c.data("ts",1),c.hasClass("hover")||setTimeout(function(){c.data("ts")&&c.data("ts",0).addClass("hover")},Q)}function o(a){var b=h(this);b.data("ts",0),b.removeClass("hover")}function p(a,b){for(;a!=document.body&&!h(a).hasClass(b);)a=a.parentNode;return a}function q(a,b,c){h(a).find(".replyBox").data("config",JSON.stringify(b)).addClass("show").addClass("first").find("textarea").attr("placeholder",c).focus()}function r(a){O=h(a);var b=h("#donateBox").addClass("show"),c=parseFloat((.1+9.9*Math.random()).toFixed(2));b.find(".sum .num").html(c),h(window).trigger("resize"),setTimeout(function(){b.css("opacity",1)},1)}function s(){var a=h("#donateBox").css("opacity",0);setTimeout(function(){a.removeClass("show").find(".input").removeClass("show").find("input").val(""),a.find(".random").addClass("show")},300)}function t(a){console.log("showDelete",a),R=a;var b=h("#rDelete").show();setTimeout(function(){b.css("background-color","rgba(0,0,0,0.4)").find(".btns").css("bottom",0)},1)}function u(){var a=p(this,"task");window.location.href="taskPublish.html"+getCommonParams()+"&actId="+encodeURIComponent(e)+"&actToken="+f+"&fNum="+encodeURIComponent(g)+"&taskId="+encodeURIComponent(h(a).attr("taskId"))}if(b=checkReply(b)){console.log("getDatingTasks reply",b);var v,w,x,y,z,A,B,C,D,E,F=b.tasks||[],G=F.length,H="",I={author:c.nickname+"&"+d.nickname},J=Math.ceil(1.25*window.fontSize),K="?"+qnImg.base()+qnImg.and+qnImg.min(J*window.dpi,J*window.dpi),L=4*window.fontSize,M="?"+qnImg.base()+qnImg.and+qnImg.min(L*window.dpi,L*window.dpi);for(v=0;G>v;v++){for(x=F[v],I.uniId=x.uniId,I.title=x.title,I.date=x.date,I.taskName="新挑战",I.status=" new",I.praiseClass=" empty",I.donateClass=" empty",I.commentClass=" empty",I.praised="praise",I.praiseText="点赞",I.doClass="",I.doText="",I.taskId=x.taskId,I.userHead=window.userInfo.headImg+K,I.userId=window.userInfo.uid,I.titleImgClass="",0==x.flag?(I.taskName="挑战"+I.taskId,I.status="",I.titleImg=window.imgUrl.taskFinished,(window.uid==c.guestId||window.uid==d.guestId)&&(I.titleImg=window.imgUrl.taskEdit,I.titleImgClass="taskEdit")):(I.doClass=" encourage",I.doText="加油",I.titleImg="",(window.uid==c.guestId||window.uid==d.guestId)&&(I.doClass=" publish",I.doText="提交任务")),0==x.praised&&(I.praised="cancelPraise",I.praiseText="取消"),I.texts=x.reply,I.textClass="",I.showMore="",I.texts&&I.texts.length>200&&(I.textClass=" tooLong",I.showMore=" show"),I.photos="",y=x.photos.length,w=0;y>w;w++)I.photos+='<div class="bgCon" psrc="'+x.photos[w]+M+'" osrc="'+x.photos[w]+'"></div>';for(I.praises="",z=x.praiseList&&x.praiseList.length,z&&(I.praiseClass="",I.praises+='<span class="name" uid="'+x.praiseList[0].ownerId+'">'+x.praiseList[0].nickname+"</span>"),w=1;z>w;w++)I.praises+='<span class="dot">, </span><span class="name" uid="'+x.praiseList[w].ownerId+'">'+x.praiseList[w].nickname+"</span>";for(I.donates="",A=x.donateList&&x.donateList.length,A&&(I.donateClass=""),w=0;A>w;w++)E=x.donateList[w],C={psrc:E.headImg+K,nickname:E.nickname,ownerId:E.ownerId,sum:E.sum},I.donates+=format(j,C);for(I.comments="",B=x.commentList&&x.commentList.length,B&&(I.commentClass=""),w=0;B>w;w++)D="targetName"in x.commentList[w],E=x.commentList[w],C={uniId:E.uniId,psrc:E.headImg+K,nickname:E.nickname,ownerId:E.ownerId,text:E.text,showTarget:D?"":" hide",targetName:D?E.targetName:"",targetId:D?E.targetId:""},I.comments+=format(k,C);H+=format(i,I)}var N=h("#taskList");N.html(H).find(".bgCon").each(function(){var a=h(this).attr("psrc");a&&(h(this).removeAttr("psrc"),lazyLoadImg(a,this))}),N.find(".photos").on("click",".bgCon",function(){var a=h(this).attr("osrc");if(a){var b=h(this).parent(),c=b.data("list");wxPreviewImg(a,c)}}).each(function(){var a=[];h(this).find(".bgCon").each(function(){var b=h(this).attr("osrc");b&&a.push(b)}),h(this).data("list",JSON.stringify(a))});var O,P=200,Q=100;['<div class="replyBox">','<textarea placeholder="{holder}"></textarea>','<button class="replySubmit">确定</button>',"</div>"].join("");h("#donateBox").off("click").on("click",function(a){for(var b=a.target;b!=this;){if(h(b).hasClass("content"))return;b=b.parentNode}s()}).on("click",".close",s).on("click",".switch",function(){var a=h(this).parent().parent();a.find(".random").removeClass("show"),a.find(".input").addClass("show"),a.find(".input input").focus()}).on("click",".submit",function(){console.log("submit on click");var a,b=h(this).parent(),c=0;if(b.find(".random").hasClass("show"))c=b.find(".sum .num").html();else if(a=b.find(".input input"),c=a.val(),!c)return void a.addClass("warning").focus();try{c=parseFloat(c)}catch(d){return alert("捐赠金额异常,请重试"),void s()}return.1>c?void alert("捐赠金额最少为0.1元"):c?(c=Math.min(c,200),donate({uniId:O.attr("uniId"),sum:c,callback:function(){var a=Math.ceil(1.25*window.fontSize),b="?"+qnImg.base()+qnImg.and+qnImg.min(a*window.dpi,a*window.dpi),d={psrc:window.userInfo.headImg+b,nickname:window.userInfo.nickname,ownerId:window.userInfo.uid,sum:c},e=format(j,d);O.find(".donates").append(e).removeClass("empty").find(".bgCon").each(function(){var a=h(this).attr("psrc");a&&(h(this).removeAttr("psrc"),lazyLoadImg(a,this))})}}),void s()):(alert("捐赠金额异常,请重试"),void s())}).on("touchmove",function(a){a.preventDefault()});var R;h("#rDelete").off("click").on("click",function(){var a=h(this);a.css("background-color","rgba(0,0,0,0)").find(".btns").css("bottom",-6*window.fontSize),setTimeout(function(){a.hide()},300)}).on("click",".delete",function(){R&&R.length&&(deleteComment({uniId:R.attr("uniId")}),R.remove(),R=null)}).on("touchmove",function(a){a.preventDefault()}),h(window).on("resize",function(){var a=h("#donateBox");if(a.hasClass("show")){var b=a.find(".main"),c=a.height(),d=b.height(),e=Math.max(0,(c-d)/3);b.css("top",e)}}),N.on("click",".publish",u).on("click",".taskEdit",u).on("click",".showMore",function(){var a=h(this).parent().find(".text");a.hasClass("tooLong")?(a.removeClass("tooLong"),h(this).html("收起")):(a.addClass("tooLong"),h(this).html("全文"))}).on("click",".act",function(){var a=h(this),b=a.parent();console.log("act onclick"),a.hasClass("show")?(a.removeClass("show"),b.find(".btns").css("left","100%"),setTimeout(function(){b.find(".tools").hide()},P)):(a.addClass("show"),b.find(".tools").show(),setTimeout(function(){b.find(".btns").css("left","0")},0))}).on("click",".btns",function(){var a=h(this),b=a.parent();b.parent().find(".act").removeClass("show"),a.css("left","100%"),console.log("btns onclick"),setTimeout(function(){b.hide()},P)}).on("click",".btns .comment",function(a){console.log("wanna comment");var b=p(this,"task"),c=h(b).attr("uniId");q(b,{uniId:c},"评论:")}).on("click",".encourage",function(a){console.log("wanna comment");var b=p(this,"task"),c=h(b).attr("uniId");q(b,{uniId:c},"为他&她加油:")}).on("click",".rItem",function(a){for(var b=a.target;b!=this;){if(h(b).hasClass("name")||h(b).hasClass("target"))return;b=b.parentNode}console.log("rItem click");var c=h(this),d=this,e=p(this,"task"),f=c.find(".name"),g=f.html(),i=f.attr("uid"),j=h(e).attr("uniId");userReady(function(){var a=c.parent(),b=!1;window.userInfo.uid!=i?(a.hasClass("comments")?a.find(".rItem").each(function(){b&&h(this).addClass("tmpHide"),this==d&&(b=!0)}):a.hasClass("donates")&&h(e).find(".comments").addClass("tmpHide"),q(e,{uniId:j,targetId:i,targetName:g},"回复"+g+":")):a.hasClass("comments")&&t(c)})}).on("change",".replyInput",function(){console.log("replyInput change");var a=h(this).val();a&&h(this).removeClass("warning")}).on("click",".replySubmit",function(){console.log("wanna submit reply");var a=h(this),b=a.parent().find(".replyInput"),c=b.val();if(!c)return void b.addClass("warning").focus();b.removeClass("warning").val("");var d=a.parent().removeClass("show").data("config"),e=p(this,"task"),f=h.extend(d,{text:c});comment(f),h(e).find(".tmpHide").removeClass("tmpHide"),userReady(function(){var a="targetName"in f,b=Math.ceil(1.25*window.fontSize),c="?"+qnImg.base()+qnImg.and+qnImg.min(b*window.dpi,b*window.dpi),d={psrc:window.userInfo.headImg+c,nickname:window.userInfo.nickname,ownerId:window.userInfo.uid,text:f.text,showTarget:a?"":" hide",targetName:a?f.targetName:"",targetId:a?f.targetId:""},g=format(k,d);h(e).find(".comments").append(g).removeClass("empty").find(".bgCon").each(function(){var a=h(this).attr("psrc");a&&(h(this).removeAttr("psrc"),lazyLoadImg(a,this))})})}).on("click",".btns .praise",function(){console.log("wanna praise");var a=h(this),b=p(this,"task"),c=h(b).attr("uniId");userReady(function(){var c=h(b).find(".praises"),d="";c.hasClass("empty")||(d+='<span class="dot">, </span>'),d+='<span class="name" uid="'+window.uid+'">'+window.userInfo.nickname+"</span>",c.removeClass("empty").find(".list").append(d),a.removeClass("praise").find("span").html("取消"),setTimeout(function(){a.addClass("cancelPraise")},P)}),praise({uniId:c})}).on("click",".btns .cancelPraise",function(){console.log("wanna cancelPraise");var a=h(this),b=p(this,"task"),c=h(b).attr("uniId"),d=[],e=h(b).find(".praises"),f="";e.find(".name").each(function(){var a=h(this).attr("uid");a!=window.uid&&d.push({name:h(this).html(),uid:a})});var g,i=d.length;if(i>0)for(f+='<span class="name" uid="'+d[0].uid+'">'+d[0].name+"</span>",g=1;i>g;g++)f+='<span class="dot">, </span><span class="name" uid="'+d[g].uid+'">'+d[g].name+"</span>";else e.addClass("empty");e.find(".list").html(f),a.removeClass("cancelPraise").find("span").html("点赞"),setTimeout(function(){a.addClass("praise")},P),cancelPraise({uniId:c})}).on("click",".btns .donate",function(){var a=p(this,"task"),b=(h(a).attr("uniId"),p(this,"task"));r(b)}).on("click",".head",function(){a(h(this).attr("uid"))}).on("click",".name",function(){a(h(this).attr("uid"))}).on("click",".target",function(){a(h(this).attr("uid"))}).on("touchstart",".name",l).on("touchend",".name",m).on("touchstart",".target",l).on("touchend",".target",m).on("touchstart",".commentText",n).on("touchend",".commentText",o),h(document.body).on("touchstart",function(a){for(var b=a.target;b!=document.body;){if(h(b).hasClass("cmd"))return;b=b.parentNode}h(".cmd").each(function(){var a=h(this),b=a.find(".act");b.hasClass("show")&&(b.removeClass("show"),a.find(".btns").css("left","100%"),setTimeout(function(){a.find(".tools").hide()},P))})}).on("click",function(a){for(var b=a.target;b!=this;){if(h(b).hasClass("replyBox"))return;b=b.parentNode}h(".replyBox").each(function(){var a=h(this),b=a.hasClass("first");if(a.removeClass("first"),a.hasClass("show")&&!b){var c=a.find(".replyInput");if(!c.hasClass("warning")){var d,e=c.val();e||(a.removeClass("show"),d=p(this,"task"),h(d).find(".tmpHide").removeClass("tmpHide"))}}})})}},error:function(a){noNetwork()},complete:function(){l=!1}}))}var c,d,e=getValueFromSearch("actId"),f=getValueFromSearch("actToken"),g=getValueFromSearch("fNum"),h=Z,i=['<div class="task{status}" uniId="{uniId}" taskId="{taskId}">','<div class="title">','<div class="content">',"<span>{taskName}：</span>","<span>{title}</span>",'<img src="{titleImg}" class="{titleImgClass}">',"</div>","</div>",'<div class="middle">','<div class="text{textClass}">','<span class="author">{author}</span>','<span class="content">: {texts}</span>',"</div>",'<div class="showMore{showMore}">全文</div>','<div class="photos">{photos}</div>','<button class="doAct{doClass}">{doText}</button>','<div class="tips">','<span class="date">{date}</span>','<div class="cmd">','<img class="act" src="'+window.imgUrl.more+'">','<div class="tools">','<div class="btns">','<button class="donate">','<img src="'+window.imgUrl.whiteDonate+'">',"赞助","</button>",'<button class="{praised}">','<img src="'+window.imgUrl.whiteLike+'">',"<span>{praiseText}</span>","</button>",'<button class="comment">','<img src="'+window.imgUrl.whiteComment+'">',"评论","</button>",'<div class="gap left"></div>','<div class="gap right"></div>',"</div>","</div>","</div>","</div>","</div>",'<div class="praises{praiseClass}">','<div class="liked"></div>','<div class="list">{praises}</div>',"</div>",'<div class="donates{donateClass}">{donates}</div>','<div class="comments{commentClass}">{comments}</div>','<div class="replyBox">','<div class="head bgCon" psrc="{userHead}" uid="{userId}"></div>','<textarea class="replyInput"></textarea>','<button class="replySubmit">确定</button>',"</div>","</div>"].join(""),j=['<div class="rItem">','<div class="head bgCon" psrc="{psrc}" uid="{ownerId}">','<img class="mark" src="'+window.imgUrl.redDonate+'">',"</div>",'<div class="commentText">','<span class="name" uid="{ownerId}">{nickname}</span>',"赞助了",'<span class="sum">{sum}</span>',"元","</div>","</div>"].join(""),k=['<div class="rItem" uniId="{uniId}">','<div class="head bgCon" psrc="{psrc}" uid="{ownerId}"></div>','<div class="commentText">','<span class="name" uid="{ownerId}">{nickname}</span>','<span class="reply{showTarget}">回复</span>','<span class="target{showTarget}" uid="{targetId}">{targetName}</span>','<span class="content">: {text}</span>',"</div>","</div>"].join("");h("#top").addClass("p"+g),h(".fNum").html(g),h.ajax({url:window.actionUrl.getActDetail.url,type:window.actionUrl.getActDetail.type,data:h.extend({actId:e,actToken:f},getCommonReqData()),success:function(a){if(a=checkReply(a)){var i,j=a.females,k=a.males,l=j.length;for(i=0;l>i;i++)if(j[i].guestNumber==g){c=j[i];break}for(i=0;l>i;i++)if(k[i].guestNumber==c.linkedNumber){d=k[i];break}var m=h("#top");m.find(".taskNum").html(c.taskNum),m.find(".female .num").html("女"+g),m.find(".female .name").html(c.nickname),m.find(".male .num").html("男"+d.guestNumber),m.find(".male .name").html(d.nickname);var n=4*window.fontSize,o="?"+qnImg.base()+qnImg.and+qnImg.min(n*window.dpi,n*window.dpi);lazyLoadImg(c.headImg+o,m.find(".female .bgCon")),lazyLoadImg(d.headImg+o,m.find(".male .bgCon"));var p=h("#donateBox");lazyLoadImg(c.headImg+o,p.find(".female")),lazyLoadImg(d.headImg+o,p.find(".male")),m.find(".female").on("click",function(){window.location.href="guestInfo.html"+getCommonParams()+"&actId="+encodeURIComponent(e)+"&actToken="+f+"&sex=0&num="+encodeURIComponent(c.guestNumber)}),m.find(".male").on("click",function(){window.location.href="guestInfo.html"+getCommonParams()+"&actId="+encodeURIComponent(e)+"&actToken="+f+"&sex=1&num="+encodeURIComponent(d.guestNumber)}),userReady(b)}},error:function(a){noNetwork()}});var l=!1});
//# sourceMappingURL=dating.js.map