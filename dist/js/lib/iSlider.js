!function(a){"use strict";function b(a,b){return b.indexOf(a)>-1}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function e(a,b){d(a,b)||(a.className+=" "+b)}function f(a,b){d(a,b)&&(a.className=a.className.replace(RegExp("(\\s|^)"+b+"(\\s|$)"),""))}function g(a){if(/<\/?[^>]*>/g.test(a))return!1;var b="^(((https|http|ftp|rtsp|mms):)?//)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})?(:[0-9]{1,4})?([^?#]+)?(\\?[^#]+)?(#.+)?$";return new RegExp(b).test(a)}var h=function(){var a=Array.prototype.slice.call(arguments,0,3);if(!a.length)throw new Error("Parameters required!");var b=a.pop();switch(a.length){case 2:b.data=b.data||a[1];case 1:b.dom=b.dom||a[0]}if(!b.dom)throw new Error("Container can not be empty!");if(!b.data||!b.data.length)throw new Error("Data must be an array and must have more than one element!");this._opts=b,this._LSN={},b=a=null,this._setting(),this.fire("initialize"),this._renderWrapper(),this._initPlugins(),this._bindHandler()};h.EVENTS="initialize slide slideStart slideEnd slideChange slideChanged slideRestore slideRestored reloadData destroy".split(" "),h.EASING=["linear ease ease-in ease-out ease-in-out".split(" "),/cubic-bezier\(([^\d]*(\d+.?\d*)[^\,]*\,?){4}\)/],h.FIX_PAGE_TAGS="SELECT INPUT TEXTAREA BUTTON LABEL".split(" "),h.EMPTY_FUNCTION=function(){},h.extend=function(){var a,b,c=arguments;switch(c.length){case 0:return;case 1:a=h.prototype,b=c[0];break;case 2:a=c[0],b=c[1]}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])},h.plugins={},h.regPlugin=function(a,b){h.plugins[a]=h.plugins[a]||b},h._animateFuncs={"default":function(a,b,c,d,e){a.style.webkitTransform="translateZ(0) translate"+b+"("+(e+c*(d-1))+"px)"}},h._transitionEndEvent=function(){var a;return function(){if(a)return a;var b=document.createElement("fakeElement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var d in c)if(c.hasOwnProperty(d)&&void 0!==b.style[d])return a=c[d]}}();var i=h.prototype;i.extend=h.extend,i._setting=function(){this._plugins=h.plugins,this._animateFuncs=h._animateFuncs,this.holding=!1,this.locking=!1;var d=this._opts;this.wrap=d.dom,this.data=d.data,this.isVertical=d.isVertical||!1,this.isOverspread=d.isOverspread||!1,this.duration=d.duration||2e3,this.initIndex=d.initIndex>0&&d.initIndex<d.data.length-1?d.initIndex:0,this.fixPage=d.fixPage||!0,this.slideIndex=this.slideIndex||this.initIndex||0,this.axis=this.isVertical?"Y":"X",this.reverseAxis="Y"===this.axis?"X":"Y",this.width=this.wrap.clientWidth,this.height=this.wrap.clientHeight,this.ratio=this.height/this.width,this.scale=this.isVertical?this.height:this.width,this.offset=this.offset||{X:0,Y:0},this.isLooping=this.data.length>1&&d.isLooping?!0:!1,this.isAutoplay=this.data.length>1&&d.isAutoplay?!0:!1,"card"===d.animateType&&this.isVertical&&(this.isOverspread=!0),this.log=d.isDebug?function(){a.console.log.apply(a.console,arguments)}:h.EMPTY_FUNCTION,this._setUpDamping(),this._animateFunc=this._animateFuncs[d.animateType in this._animateFuncs?d.animateType:"default"],this.animateTime=null!=d.animateTime&&d.animateTime>-1?d.animateTime:300,this.animateEasing=b(d.animateEasing,h.EASING[0])||h.EASING[1].test(d.animateEasing)?d.animateEasing:"ease",this.inAnimate=0,this.deviceEvents=function(){var b=!!("ontouchstart"in a||a.DocumentTouch&&document instanceof a.DocumentTouch);return{hasTouch:b,startEvt:b?"touchstart":"mousedown",moveEvt:b?"touchmove":"mousemove",endEvt:b?"touchend":"mouseup"}}(),this.events={},this.on("slide",d.onslide),this.on("slideStart",d.onslidestart),this.on("slideEnd",d.onslideend),this.on("slideChange",d.onslidechange),this.on("slideChanged",d.onslidechanged),this.on("slideRestore",d.onsliderestore),this.on("slideRestored",d.onsliderestored),this.pluginConfig=function(){if(c(d.plugins)){var a={};return d.plugins.forEach(function(b){c(b)?a[b[0]]=b.slice(1):"string"==typeof b&&(a[b]=[])}),a}return{}}(),this.isAutoplay&&this.play()},i._initPlugins=function(){var a=this.pluginConfig,b=this._plugins;for(var c in a)a.hasOwnProperty(c)&&b.hasOwnProperty(c)&&(this.log("[INIT PLUGIN]:",c,b[c]),b[c]&&"function"==typeof b[c]&&typeof b[c].apply&&b[c].apply(this,a[c]))},i._setUpDamping=function(){var a=this.scale>>1,b=a>>1,c=b>>2;this._damping=function(d){var e,f=Math.abs(d);return e=a>f?f>>1:a+b>f?b+(f-a>>2):b+c+(f-a-b>>3),d>0?e:-e}},i._itemType=function(a){if(isNaN(a)||(a=this.data[a]),a.hasOwnProperty("type"))return a.type;var b,c=a.content;return b=null==c?"empty":Boolean(c.nodeName)&&Boolean(c.nodeType)?"node":"string"==typeof c?g(c)?"pic":"html":"unknown",a.type=b,b},i._renderItem=function(a,b){console.log("_renderItem",a);var c,d=this.data.length,e=function(){var b=' src="'+c.content+'"';this.isOverspread&&(a.style.background="url("+c.content+") no-repeat 50% 50%/cover",b+=' style="display:block;opacity:0;height:100%;width:100%;"'),a.innerHTML="<img"+b+" />"}.bind(this);if(a.innerHTML="",a.style.background="",this.isLooping||null!=this.data[b]){b=(d+b)%d,c=this.data[b];var f=this._itemType(c);switch(this.log("[Render ITEM]:",f,b,c),a.className="islider-"+f,f){case"pic":if(c.height&&c.width)e();else{var g=new Image;g.src=c.content,g.onload=function(){c.height=g.height,c.width=g.width,c.loaded=1,e()}}break;case"dom":case"html":a.innerHTML=c.content;break;case"node":case"element":if(11===c.content.nodeType){var h=document.createElement("div");h.appendChild(c.content),c.content=h}a.appendChild(c.content)}}},i._renderIntermediateScene=function(){null!=this._intermediateScene&&(this._renderItem.apply(this,this._intermediateScene),this._intermediateScene=null)},i._changedStyles=function(){var a=["islider-prev","islider-active","islider-next"];this.els.forEach(function(b,c){f(b,"("+a.join("|")+")"),e(b,a[c])})},i._renderWrapper=function(){console.log("_renderWrapper"),this.outer&&(this.outer.innerHTML="");var b=this.outer||document.createElement("ul");b.className="islider-outer",this.els=[];for(var c=0;3>c;c++){var d=document.createElement("li");this.els.push(d),this._animateFunc(d,this.axis,this.scale,c,0),!this.isVertical||"rotate"!==this._opts.animateType&&"flip"!==this._opts.animateType?this._renderItem(d,c-1+this.slideIndex):this._renderItem(d,1-c+this.slideIndex),b.appendChild(d)}this._changedStyles(),a.setTimeout(function(){this._preloadImg(this.slideIndex)}.bind(this),200),this.outer||(this.outer=b,this.wrap.appendChild(b))},i._preloadImg=function(a){if(this.data.length>3){var b=this.data,c=b.length,d=this,e=function(a){var c=b[a];if("pic"===d._itemType(c)&&!c.loaded){var e=new Image;e.src=c.content,e.onload=function(){c.width=e.width,c.height=e.height},c.loaded=1}};e((a+2)%c),e((a-2+c)%c)}},i._watchTransitionEnd=function(b,c){function d(b){f&&a.clearTimeout(f),g.inAnimate--,g.log("Event:","watchTransitionEnd::stuck::release",g.inAnimate),0===g.inAnimate&&("slideChanged"===c&&g._changedStyles(),g.fire.apply(g,i),g._renderIntermediateScene()),e()}function e(){g.els.forEach(function(a){a.removeEventListener(h._transitionEndEvent(),d)}),g.isAnimating=!1}var f,g=this,i=Array.prototype.slice.call(arguments,1);this.log("Event:","watchTransitionEnd::stuck::pile",this.inAnimate),b>0&&g.els.forEach(function(a){a.addEventListener(h._transitionEndEvent(),d)}),f=a.setTimeout(d,b),g.inAnimate++},i._bindHandler=function(){var b=this.outer,c=this.deviceEvents;c.hasTouch||(b.style.cursor="pointer",b.ondragstart=function(a){return a?!1:!0}),b.addEventListener(c.startEvt,this),b.addEventListener(c.moveEvt,this),b.addEventListener(c.endEvt,this),a.addEventListener("orientationchange",this),a.addEventListener("resize",this),a.addEventListener("focus",this,!1),a.addEventListener("blur",this,!1)},i.handleEvent=function(a){var b=this.deviceEvents;switch(a.type){case"mousedown":if(0!==a.button||1!==a.buttons)break;case"touchstart":this.startHandler(a);break;case b.moveEvt:this.moveHandler(a);break;case b.endEvt:case"touchcancel":this.endHandler(a);break;case"orientationchange":this.orientationchangeHandler();break;case"focus":this.isAutoplay&&this.play();break;case"blur":this.pause();break;case"resize":this.resizeHandler()}},i.startHandler=function(a){if(this.fixPage&&h.FIX_PAGE_TAGS.indexOf(a.target.tagName)<0&&a.preventDefault(),!this.holding&&!this.locking){var b=this.deviceEvents;this.isMoving=!0,this.pause(),this.log("Event: start"),this.fire("slideStart",a,this),this.startTime=(new Date).getTime(),this.startX=b.hasTouch?a.targetTouches[0].pageX:a.pageX,this.startY=b.hasTouch?a.targetTouches[0].pageY:a.pageY}},i.moveHandler=function(a){if(this.isMoving){this.log("Event: moving");var b=this.deviceEvents,c=this.data.length,d=this.axis,e=this.reverseAxis,f={X:b.hasTouch?a.targetTouches[0].pageX-this.startX:a.pageX-this.startX,Y:b.hasTouch?a.targetTouches[0].pageY-this.startY:a.pageY-this.startY};if(this.offset=f,Math.abs(f[d])-Math.abs(f[e])>10){a.preventDefault(),this.fire("slide",a,this),this.isLooping||(f[d]>0&&0===this.slideIndex||f[d]<0&&this.slideIndex===c-1)&&(f[d]=this._damping(f[d]));for(var g=0;3>g;g++){var h=this.els[g];h.style.webkitTransition="all 0s",this._animateFunc(h,d,this.scale,g,f[d])}}}},i.endHandler=function(b){if(this.isMoving){this.log("Event: end"),this.isMoving=!1;var c=this.offset,d=this.axis,e=this.scale/2,f=(new Date).getTime();e=f-this.startTime>300?e:14;var g=Math.abs(c[d]),h=Math.abs(c[this.reverseAxis]),i=function(b){if("A"===b.tagName){if(b.href)return a.location.href=b.href,!1}else{if("islider-pic"!==b.className)return!1;i(b.parentNode)}};this.log(e,c[d],g,h,this),c[d]>=e&&g>h?this.slideTo(this.slideIndex-1):c[d]<-e&&g>h?this.slideTo(this.slideIndex+1):this.slideTo(this.slideIndex),Math.abs(this.offset.X)<10&&Math.abs(this.offset.Y)<10&&(this.tapEvt=document.createEvent("Event"),this.tapEvt.initEvent("tap",!0,!0),this.fixPage&&b.target&&i(b.target),b.target.dispatchEvent(this.tapEvt)||b.preventDefault()),this.offset.X=this.offset.Y=0,this.isAutoplay&&this.play(),this.fire("slideEnd",b,this)}},i.orientationchangeHandler=function(){a.setTimeout(function(){this.reset(),this.log("Event: orientationchange")}.bind(this),100)},i.resizeHandler=function(){(this.height!==this.wrap.clientHeight||this.width!==this.wrap.clientWidth)&&(this._LSN.resize&&a.clearTimeout(this._LSN.resize),this._LSN.resize=a.setTimeout(function(){this.reset(),this.log("Event: resize"),this._LSN.resize&&a.clearTimeout(this._LSN.resize)}.bind(this),500))},i.slideTo=function(b,c){if(!this.locking){this.unhold();var d,e=this.animateTime,f=this._opts.animateType,g=this._animateFunc,h=this.data,i=this.els,j=b,k=b-this.slideIndex,l=this.offset;"object"==typeof c&&(c.animateTime>-1&&(e=c.animateTime),"string"==typeof c.animateType&&c.animateType in this._animateFuncs&&(f=c.animateType,g=this._animateFuncs[f]));var m=Math.abs(l[this.axis])/this.scale*e;Math.abs(k)>1&&this._renderItem(k>0?this.els[2]:this.els[0],j),this._preloadImg(j),h[j]?this.slideIndex=j:this.isLooping?this.slideIndex=k>0?0:h.length-1:(this.slideIndex=this.slideIndex,k=0),this.log("Index:"+this.slideIndex);var n,o,p;0===k?d="slideRestore":((this.isVertical&&("rotate"===f||"flip"===f))^k>0?(i.push(i.shift()),n=i[2],o=i[0],p=1):(i.unshift(i.pop()),n=i[0],o=i[2],p=-1),1===Math.abs(k)?(this._renderIntermediateScene(),this._renderItem(n,j+k)):Math.abs(k)>1&&(this._renderItem(n,j+p),this._intermediateScene=[o,j-p]),n.style.webkitTransition="none",n.style.visibility="hidden",a.setTimeout(function(){n.style.visibility="visible"},200),m=e-m,d="slideChange"),this.fire(d,this.slideIndex,i[1],this),this._watchTransitionEnd(m,d+"d",this.slideIndex,i[1],this);for(var q=0;3>q;q++)i[q]!==n&&(i[q].style.webkitTransition="all "+m/1e3+"s "+this.animateEasing),g.call(this,i[q],this.axis,this.scale,q,0);this.isAutoplay&&!this.isLooping&&this.slideIndex===h.length-1&&this.pause()}},i.slideNext=function(){this.slideTo.apply(this,[this.slideIndex+1].concat(Array.prototype.slice.call(arguments)))},i.slidePrev=function(){this.slideTo.apply(this,[this.slideIndex-1].concat(Array.prototype.slice.call(arguments)))},i.regPlugin=function(){var a=Array.prototype.slice.call(arguments),c=a.shift(),d=a[0];(this._plugins.hasOwnProperty(c)||"function"==typeof d)&&("function"==typeof d&&(this._plugins[c]=d,a.shift()),b(c,this._opts.plugins)||(this._opts.plugins.push(a.length?[].concat([c],a):c),"function"==typeof this._plugins[c]&&this._plugins[c].apply(this,a)))},i.bind=i.delegate=function(b,c,d){function e(b){for(var e=a.event?a.event:b,f=e.target,g=document.querySelectorAll(c),h=0;h<g.length;h++)if(f===g[h]){d.call(f);break}}this.wrap.addEventListener(b,e,!1)},i.unbind=i.unDelegate=function(a,b,c){},i.destroy=function(){var b=this.outer,c=this.deviceEvents;this.fire("destroy"),b.removeEventListener(c.startEvt,this),b.removeEventListener(c.moveEvt,this),b.removeEventListener(c.endEvt,this),a.removeEventListener("orientationchange",this),a.removeEventListener("focus",this),a.removeEventListener("blur",this),this._LSN.forEach(function(b){b&&a.clearTimeout(b)}),this.wrap.innerHTML=""},i.on=function(a,c){b(a,h.EVENTS)&&"function"==typeof c&&(a in this.events?this.events[a]:this.events[a]=[]).push(c)},i.off=function(a,b){if(a in this.events){var c=this.events[a],d=c.indexOf(b);d>-1&&delete c[d]}},i.fire=function(a){if(this.log("[EVENT FIRE]:",a,arguments),a in this.events)for(var b=this.events[a],c=0;c<b.length;c++)"function"==typeof b[c]&&b[c].apply&&b[c].apply(this,Array.prototype.slice.call(arguments,1))},i.reset=function(){this.pause(),this._setting(),this._renderWrapper(),this.isAutoplay&&this.play()},i.loadData=function(a,b){this.pause(),this.slideIndex=b||0,this.data=a,this._renderWrapper(),this.fire("reloadData"),this.isAutoplay&&this.play()},i.play=function(){function b(){c._LSN.autoPlay=setTimeout(function(){c.slideNext(),b()},c.duration)}var c=this;this._LSN.autoPlay&&a.clearTimeout(this._LSN.autoPlay),b()},i.pause=function(){this._LSN.autoPlay&&clearTimeout(this._LSN.autoPlay)},i.hold=function(){this.holding=!0},i.unhold=function(){this.holding=!1,this.unlock()},i.lock=function(){this.hold(),this.locking=!0},i.unlock=function(){this.locking=!1},"function"==typeof require&&"object"==typeof module&&module&&"object"==typeof exports&&exports?module.exports=h:"function"==typeof define&&define.amd?define(function(){return h}):a.iSlider=a.iSlider||h}(this||window);