"use strict";Z(function(){function a(){window.location.href="actDetail.html"+getCommonParams()+"&actId="+encodeURIComponent(e)+"&actToken="+encodeURIComponent(f)}function b(){confirm("没有更多嘉宾了，去邀请好友吧！")&&(window.location.href="creatorCard.html"+getCommonParams()+"&actId="+encodeURIComponent(e)+"&actToken="+encodeURIComponent(f))}function c(a){var b="femaleResult",c="femaleNav",d="femaleTab";g=a,"male"==g&&(b="maleResult",c="maleNav",d="maleTab"),Z(".tabPage").hide(),Z("#"+d).show(),Z("#tabNav").find(".nav").removeClass("current"),Z("#"+c).addClass("current"),Z(".resultBox").removeClass("current"),Z("#"+b).addClass("current")}var d=Z,e=getValueFromSearch("actId"),f=getValueFromSearch("actToken"),g="female";Z.ajax({url:window.actionUrl.getActDetail.url,type:window.actionUrl.getActDetail.type,data:Z.extend({actId:e,actToken:f},getCommonReqData()),success:function(b){if(b=checkReply(b)){replaceImgSrc(Z("#actNav"));var c=Math.ceil(2.2*window.fontSize),d="?"+qnImg.base()+qnImg.and+qnImg.min(c*window.dpi,c*window.dpi);lazyLoadImg(b.creatorHead+d,Z("#creatorHead"));var e=Math.ceil(Z(document.body).width()),f=Math.ceil(3.3*window.fontSize),g="?"+qnImg.base()+qnImg.and+qnImg.min(e,f)+qnImg.and+qnImg.blur(15,5);lazyLoadImg(b.cover+g,Z("#actNav")),Z("#creatorName").html(b.creatorName),Z("#actTitle").html(b.title),Z("#actNum").html(getDateFromTs(b.createTime)+"桌"),Z("#actNav").on("click",a)}},error:function(a){noNetwork()}}),Z.ajax({url:window.actionUrl.getRegList.url,type:window.actionUrl.getRegList.type,data:Z.extend({actId:e,actToken:f},getCommonReqData()),success:function(h){function i(a){var b=Z(a).attr("psrc");b&&(Z(a).removeAttr("psrc"),lazyLoadImg(b+C,a))}function j(){var a=Z(this).attr("uid")||Z(this).data("uid"),b=F[a];console.log("showDetail",a,b);var c=Z("#detail");c.show();var e="female",f=!1;if(1==b.sex?(e="male",f=s(a)):f=r(a),console.log("choosed",f),f?(Z("#uChoose").html("取消选择").addClass("cancel"),Z("#uHead").addClass("select")):(Z("#uChoose").html("选择").removeClass("cancel"),Z("#uHead").removeClass("select")),c.find(".main .scrollArea").scrollTop(0),setTimeout(function(){c.css("background-color","rgba(0,0,0,0.7)").find(".main").css("transform","translateY(0)")},10),c.data("uid")!=a){c.data("uid",a),Z("#uNickname").html(b.nickname),Z("#uSelfIntro").html(b.selfIntro),Z("#uExpectation").html(b.expectation),Z("#uSex").removeClass("male").removeClass("female").addClass(e),Z("#uAge").html(getAgeFromDate(b.birthday)),Z("#uXingZuo").html(getXingZuoFromDate(b.birthday)),Z("#uPlace").html(b.province+b.city),lazyLoadImg(b.headImg,Z("#uHead"));var g,h,j=b.photos||[],k=j.length,l="",m=[],n="?"+qnImg.base();for(g=0;k>g;g++)h=j[g]+n,m.push(h),l+='<div class="bgCon" psrc="'+j[g]+'" osrc="'+h+'"></div>';d("#uPhotos").html(l).find(".bgCon").each(function(){i(this),d(this).on("click",function(){wxPreviewImg(d(this).attr("osrc"),m)})}),judgeScroll(c.find(".main .scrollArea")[0])}}function k(){Z("#detail").css("background-color","rgba(0,0,0,0)").find(".main").css("transform","translateY(100%)"),setTimeout(function(){Z("#detail").hide()},300)}function l(){return H.length==window.actConfig.pairs}function m(){return I.length==window.actConfig.pairs}function n(a){Z("#femaleTab").find(".head").each(function(){Z(this).attr("uid")==a&&Z(this).addClass("select")});var b=H.length;H.push(a);var c=F[a];lazyLoadImg(c.headImg+C,Z("#f"+b).data("uid",a).addClass("select"))}function o(a){Z("#femaleTab").find(".select").each(function(){Z(this).attr("uid")==a&&Z(this).removeClass("select")});var b,c,d,e=H.length;for(b=0;e>b;b++)if(H[b]==a){for(H.splice(b,1),e--,c=b;e>c;c++)d=F[H[c]],lazyLoadImg(d.headImg+C,Z("#f"+c).data("uid",d.uid));lazyLoadImg(window.imgUrl.femaleHead,Z("#f"+e).removeClass("select"));break}}function p(a){Z("#maleTab").find(".head").each(function(){Z(this).attr("uid")==a&&Z(this).addClass("select")});var b=I.length;I.push(a);var c=F[a];lazyLoadImg(c.headImg+C,Z("#m"+b).data("uid",a).addClass("select"))}function q(a){Z("#maleTab").find(".select").each(function(){Z(this).attr("uid")==a&&Z(this).removeClass("select")});var b,c,d,e=I.length;for(b=0;e>b;b++)if(I[b]==a){for(I.splice(b,1),e--,c=b;e>c;c++)d=F[I[c]],lazyLoadImg(d.headImg+C,Z("#m"+c).data("uid",d.uid));lazyLoadImg(window.imgUrl.maleHead,Z("#m"+e).removeClass("select"));break}}function r(a){var b,c=H.length;for(b=0;c>b;b++)if(H[b]==a)return!0;return!1}function s(a){var b,c=I.length;for(b=0;c>b;b++)if(I[b]==a)return!0;return!1}function t(){var a=Z("#detail"),b=Z("#uChoose"),c=a.data("uid");if(c){var d=F[c];if(0==d.sex)if(r(c))b.html("选择").removeClass("cancel"),o(c);else{if(l())return void alert("女嘉宾已经选满了!");n(c)}else if(s(c))b.html("选择").removeClass("cancel"),q(c);else{if(m())return void alert("男嘉宾已经选满了!");p(c)}k()}}if(h=checkReply(h)){console.log("getRegList reply",h);var u,v=['<div class="head" uid={id}>','<img src="'+window.imgUrl.choosedFlag+'" class="flag">','<div class="bgCon" psrc="{img}"></div>','<div class="text textAutoHide">{nn}</div>',"</div>"].join(""),w=h.list||[],x=w.length,y=0,z=0,A={},B=Math.ceil(3*window.fontSize),C="?"+qnImg.base()+qnImg.and+qnImg.min(B*window.dpi,B*window.dpi),D="",E="",F={};for(u=0;x>u;u++)A.id=w[u].uid,A.img=w[u].headImg,A.nn=w[u].nickname,0==w[u].sex?(y++,D+=format(v,A)):(z++,E+=format(v,A)),F[A.id]=w[u];var G='<div class="invite"></div>';D+=G,E+=G,Z("#maleTab").html(E).find(".bgCon").each(function(){i(this)}),Z("#femaleTab").html(D).find(".bgCon").each(function(){i(this)}),Z("#maleTab").on("click",".head",j).on("click",".invite",b),Z("#femaleTab").on("click",".head",j).on("click",".invite",b),Z("#femaleResult").on("click",".select",j),Z("#maleResult").on("click",".select",j),Z("#detail .footer .back").on("click",k),Z("#detail").on("click",".mask",k);var H=[],I=[];Z("#uChoose").on("click",t),Z("#rChoose").on("click",function(){var a="男",b=m,c=s,e=p,f=1,h=function(){I=[],d("#maleTab .head").removeClass("select"),d("#maleResult .bgCon").removeClass("select")};if("female"==g&&(f=0,a="女",b=l,c=r,e=n,h=function(){H=[],d("#femaleTab .head").removeClass("select"),d("#femaleResult .bgCon").removeClass("select")}),b()){if(!confirm(a+"嘉宾已经选满了,确认要完全替换吗?"))return;h()}for(var i,j,k;!b();)i=Math.floor(Math.random()*x),k=w[i],j=k.uid,k.sex!=f||c(j)||e(j)}),Z("#cChoose").on("click",function(){if(!d(this).hasClass("ing")){if(!m())return alert("男嘉宾还没有选满!"),void c("male");if(!l())return alert("女嘉宾还没有选满!"),void c("female");if(confirm("确认要选择这些嘉宾并进入投票阶段吗?")){var b=d(this).html();d(this).addClass("ing").html("提交中..."),Z.ajax({url:window.actionUrl.chooseGuest.url,type:window.actionUrl.chooseGuest.type,data:Z.extend({actId:e,actToken:f,males:I,females:H},getCommonReqData()),success:function(b){b=checkReply(b),b&&(console.log("chooseGuest reply",b),0==b.status?(alert("选择嘉宾成功，活动进入投票阶段"),a()):alert("噫，选择嘉宾失败了，重试一次试试吧"))},error:function(){noNetwork()},complete:function(){Z("#cChoose").removeClass("ing").html(b)}})}}}),Z("#footer").on("click",".back",function(){H.length||I.length?confirm("确认要放弃这次的嘉宾选择吗?")&&a():a()})}},error:function(a){noNetwork()}}),lazyLoadImg(window.imgUrl.maleHead,Z("#maleResult .bgCon")),lazyLoadImg(window.imgUrl.femaleHead,Z("#femaleResult .bgCon")),c("female"),Z("#tabNav").on("click",".nav",function(){var a=Z(this).attr("targetId");g="female","maleTab"==a&&(g="male"),c(g)})});
//# sourceMappingURL=selectGuest.js.map