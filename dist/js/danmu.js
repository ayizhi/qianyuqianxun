$(function(){var a=function(a,d,e){function f(a){var c=d("#danmu .discussZone"),e=a.length;if(1>e)return void c.html("");var f=parseInt(Math.random()*e),g=0,h=(parseInt(d(document.body).css("font-size")),2.6),i=setInterval(function(){if(1==m.refreshListIng)return console.log("定时器中的阀门："+m.refreshListIng),void clearInterval(i);var d=parseInt(13*Math.random()),j=(d-g)/Math.abs(d-g)?(d-g)/Math.abs(d-g):2*Math.random()+1;d=Math.abs(d-g)>=h?d:d+h*j,b.init(c,a[f],d),f=f+1>e-1?0:f+1,g=d},4e3)}function g(){console.log("---------------------"),m.refreshListIng||d.ajax({url:window.actionUrl.getBarrage.url,type:window.actionUrl.getBarrage.type,data:getCommonReqData(),success:function(a){a=checkReply(a),a&&f(a.list)},error:function(a){noNetwork()},complete:function(){console.log("+++++++++++++++++++"),m.refreshListIng=!1}})}function h(a){var b=d("#danmu .myComment"),e=a.length;return 1>e?void b.html(""):void c.init(b,a)}function i(){m.refreshComment||(m.refreshComment=!0,d.ajax({url:window.actionUrl.getUserInfo.url,type:window.actionUrl.getUserInfo.type,data:getCommonReqData(),success:function(a){a=checkReply(a),a&&h(a)},error:function(a){noNetwork()},complete:function(){m.refreshComment=!1}}))}var j,k,l,m={main_html:['<div class = "switch">','<div class = "danmuTitle">弹幕</div>','<div class = "greenBg">','<div class = "button"></div>',"</div>","</div>",'<div class = "discussZone" ></div>','<div class = "myComment"></div>'].join(""),refreshListIng:!1,refreshComment:!1,controller:1};return j=function(a){m.$container=a,k(),l()},k=function(){var a=m.$container,b=m.main_html;a.html(b)},l=function(){function a(){setInterval(function(){console.log(d(".discussZone").length),console.log(d(".discussZone .allDiscuss").eq(0)),d(".discussZone .allDiscuss").eq(0).remove()},4e3)}var b=!0;g(),i(),d("#danmu .switch").on("click",function(){if(0!=b)switch(b=!1,m.controller*=-1,m.controller){case-1:d("#danmu .discussZone").html(""),d("#danmu .myComment").html(""),d("#danmu .switch .greenBg").css({backgroundColor:"#a1a0a0"}),d("#danmu .switch .button").css("left","0.035rem"),setTimeout(function(){b=!0},500),m.refreshListIng=!0,console.log(m.refreshListIng);break;case 1:d("#danmu .switch .greenBg").css({backgroundColor:"#1ead66"}),d("#danmu .switch .button").css("left","0.735rem"),setTimeout(function(){b=!0},500),m.refreshListIng=!1,console.log(m.refreshListIng),g(),i()}});setTimeout(a,17e3)},{init:j}}(window,$),b=function(a,b,c){var d,e,f,g={main_html:['<div class = "allDiscuss" id = "allDiscuss{userId}" >','<div class = "headImg"></div>','<div class="discuss">','<div class = "nice">','<div class="niceContent">','<img src="../img/common/darkLogo.png" alt=""/>{niceNum}</div>',"</div>",'<div class = "content" id = "content{userId}">{comment}</div>',"</div>","</div>"].join(""),colorList:["rgb(112, 126, 172)","rgb(164, 75, 194)","rgb(121, 165, 86)","rgb(176, 67, 101)","rgb(83, 58, 183)","rgb(110, 178, 148)","#d73027","#b2182b","#4daf4a","#ff7f00","#984ea3"]};return d=function(a,c,d,h){if(document.getElementById("allDiscuss"+c.userId))return void console.log(c.userId+"这个元素已经存在");g.$container=a;var i=c.userId;g[i]=c,g[i].top=d,g.bodyWidth=b(document.body).width(),g[i].zIndex=h,e(i),f(i)},e=function(a){var c=g.$container,d={};d.userId=g[a].userId,d.niceNum=g[a].niceNum,d.comment=g[a].content;var e=format(g.main_html,d);c.append(b(e));var f=g[a].userId;b("#danmu #allDiscuss"+f).css("top",g[a].top+"rem");var h=parseInt(b(document.body).css("font-size")),i=parseInt(b("#danmu .content").css("font-size")),j=parseInt(g[a].content.length*i);b("#danmu #allDiscuss"+f+" .discuss").css("width",j/h+4.5+"rem"),lazyLoadImg(g[a].headImg,b("#danmu #allDiscuss"+f+" .headImg"));var k=g.colorList.length;g[a].colorNum=parseInt(Math.random()*k);var l=g[a].colorNum,m=g.colorList[l];b("#danmu #allDiscuss"+f+" .discuss .nice").css("background-color",m);var n=g[a].niceNum,o=1*Math.random()+3;g[a].theNiceOriginLength=o*h;var p=b("#danmu #allDiscuss"+f+" .discuss").width(),q=p/h-o,r=n%10,s=o+r*q/10;b("#danmu #allDiscuss"+f+" .discuss .nice").css("width",s+"rem"),g[a].theWidth=b("#danmu #allDiscuss"+f).width()+b("#danmu #allDiscuss"+f+" .niceContent").width()+100,b("#danmu #allDiscuss"+f).css("z-index",g[a].zIndex),b("#danmu #allDiscuss"+f).css("left",g.bodyWidth+"px")},f=function(a){var c=g[a].userId,d={};d[c]=!0;var e=parseInt(b(document.body).css("font-size"));b("#danmu #allDiscuss"+c).on("click",function(){if(console.log("点中了点中了点中了点中了点中了点中了点中了点中了"),0!=d[c]){d[c]=!1,console.log(g[a].niceNum),g[a].niceNum++,console.log(g[a].niceNum);var f=g[a].niceNum;b("#danmu #allDiscuss"+c+" .discuss .nice .niceContent").html('<img src="../img/common/darkLogo.png" alt=""/>'+f+"</div>");var h=(g[a].niceNum,g[a].colorNum);h=h+1>g.colorList.length-1?0:h+1,g[a].colorNum=g[a].colorNum+1>g.colorList.length-1?0:g[a].colorNum+1;var i=g.colorList[h];b("#danmu #allDiscuss"+c+" .discuss .nice").css("background-color",i);var j=b("#danmu #allDiscuss"+c+" .discuss").width(),k=g[a].theNiceOriginLength,l=(j-k)/10,m=10,n=k/e;n+=l*m/e,b("#danmu #allDiscuss"+c+" .discuss .nice").css("width",n+"rem")}});var f=b("#danmu #allDiscuss"+c).width()+200;b("#danmu #allDiscuss"+c).css("transition","all 16s linear 0s").css("left",-f+"px")},{init:d}}(window,$),c=function(a,c,d){var e,f,g,h={main_html:['<div class = "userComment">','<div class="commentZone">','<div class="myHeadImg"></div>','<input class = "theComment" type="text" placeholder = "请写下你的评论..."/>',"</div>",'<div class = "send">发射</div>',"</div>"].join("")};return e=function(a,b){h.$container=a,h.data=b,f(),g()},f=function(){var a=h.$container,b=h.data;a.html(h.main_html),lazyLoadImg(b.headImg,c("#danmu .myComment .userComment .myHeadImg"))},g=function(){var a=c("#danmu .userComment .send"),d=c("#danmu .userComment .theComment"),e=10;a.on("click",function(){var f=d.attr("value"),g=parseInt(13*Math.random()),i=c("#danmu .discussZone");if(""!=f.trim()){var j={};j.userId=h.data.uniId,j.headImg=h.data.headImg,j.niceNum=0,j.content=f;var k=9999;if(document.getElementById("allDiscuss"+h.data.uniId))return void console.log(h.data.uniId+"这个元素已经存在");b.init(i,j,g,k),d.get(0).value="",a.css("backgroundColor","#cccccc"),a.html("10");var l=setInterval(function(){console.log(e),e--,0>=e?(a.css("backgroundColor","#2b9f2c"),a.html("发射"),a.disabled=!1,e=10,clearInterval(l)):a.html(e+"s")},1e3)}})},window.String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},{init:e}}(window,$);document.body.className="noTab",a.init($("#danmu"))});
//# sourceMappingURL=danmu.js.map